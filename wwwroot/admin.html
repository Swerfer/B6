 <!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Mission Admin</title>

    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <link rel="shortcut icon" href="/favicon.ico" />
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
    <meta name="apple-mobile-web-app-title" content="Be Brave Be Bold Be Banked" />
    <link rel="manifest" href="/site.webmanifest" />
    <meta name="robots" content="noindex, nofollow">
    
    <!-- GLOBAL & ADMIN STYLES -->
    <link rel="stylesheet" href="css/core.css?v452">      <!-- existing base -->
    <link rel="stylesheet" href="css/admin.css?v452">      <!-- new overrides -->

    <!-- Font Awesome & Bootstrap (same as index.html) -->
    <link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css"
            as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link rel="stylesheet"
            href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css"></noscript>
    <link rel="stylesheet"
            href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.1.3/css/bootstrap.min.css">

    <!-- Ethers & Web3Modal (local copies you already serve) -->
    <script src="js/ethers.umd.min.js"></script>
    <script src="js/web3modal.js"></script>

    <script type="module" src="js/admin.js?v452"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.1.3/js/bootstrap.bundle.min.js"
        integrity="sha512-pax4MlgXjHEPfCwcJLQhigY7+N8rt6bVvWLFyUMuxShv170X53TRzGPmPkZmGBhk+jikR8WBM4yl7A9WMHHqvg=="
        crossorigin="anonymous" referrerpolicy="no-referrer">
    </script>

</head>

<body>
    <!-- HEADER (copied “as is” from index.html) -->
    <header class="app-header">
            <div class="inner">
                <h1 class="brand-line">BE BRAVE&nbsp;&nbsp;BE BOLD&nbsp;&nbsp;BE BANKED</h1>
                <span class="subtitle">THE ULTIMATE COMPETITIVE BLOCKCHAIN GAME</span>
            </div>
    </header>

    <!-- MAIN: three placeholder panels -->
    <main id="adminMain" class="app-main core-main">
            <div class="row g-4 w-100">

                <!-- friendly notice for non-authorized visitors -->
                <div id="unauthNotice" class="unauth-notice">
                    <h2 class="mb-3">Admin Console</h2>
                    <p class="mb-4">
                        This area is for mission owners and authorised operators only.<br>
                        Please connect an authorised wallet or&nbsp;
                        <a href="../index.html" class="link-cyan">return to the homepage</a>.
                    </p>
                </div>

                <!-- ─────────── Existing missions ─────────── -->
                <section id="missionsSection" class="col-12 section-box hidden">
                    <div class="position-relative text-center">
                        <!-- Spinner shown while loading -->
                        <div id="missionsLoadingSpinner" class="missions-loading-spinner fade-spinner">
                            <div class="spinner"></div>
                        </div>
                        <!-- Hamburger absolutely positioned in top-left -->
                        <div class="dropdown position-absolute top-0 start-0">
                            <button class="btn btn-sm btn-outline-info dropdown-toggle" type="button" id="missionFilterMenu"
                                    data-bs-toggle="dropdown" aria-expanded="false">
                                <i class="fa-solid fa-bars"></i>
                            </button>
                            <ul class="dropdown-menu" aria-labelledby="missionFilterMenu">
                                <li><a class="dropdown-item" href="#" data-filter="all">All Missions</a></li>
                                <li><a class="dropdown-item" href="#" data-filter="active">Active Missions</a></li>
                                <li><a class="dropdown-item" href="#" data-filter="partial">Partly Ended Missions</a></li>
                                <li><a class="dropdown-item" href="#" data-filter="failed">Failed Missions</a></li>
                                <li><a class="dropdown-item" href="#" data-filter="ended">Ended Missions</a></li>
                                <li><hr class="dropdown-divider"></li>
                                <li><a id="latestMissionsLink" class="dropdown-item" href="#">Latest Missions…</a></li>
                            </ul>
                        </div>

                        <!-- Centered title -->
                        <h2 id="missionsTitle" class="section-title m-0">
                            <i class="fa-solid fa-list me-2"></i>All Missions
                        </h2>
                    </div>

                    <!-- list filled by admin.js -->
                    <ul id="missionsList" class="list-unstyled mb-0"></ul>
                </section>

                <!-- 1 ▸ Create missions manually -->
                <section id="createMissionSection" class="col-12 section-box hidden">

                    <h2 class="section-title">
                        <i class="fa-solid fa-plus me-2"></i>Create Missions Manually
                    </h2>

                    <!-- ─────── form ─────── -->
                    <form id="createMissionForm" class="row g-3 text-start">

                        <div class="col-12 col-md-6 offset-md-3">
                            <label class="form-label" for="missionName">Mission Name</label>
                            <input id="missionName" name="missionName" type="text" class="form-control" maxlength="24" placeholder="">
                        </div>

                        <div class="col-md-6">
                        <label class="form-label" for="missionType">Mission Type</label>
                        <select id="missionType" name="missionType" class="form-select" required>
                            <option value="0">Custom</option>
                            <option value="1">Hourly</option>
                            <option value="2">Quarter-Daily</option>
                            <option value="3">Bi-Daily</option>
                            <option value="4">Daily</option>
                            <option value="5">Weekly</option>
                            <option value="6">Monthly</option>
                        </select>
                        </div>

                        <div class="col-md-6">
                            <label class="form-label" for="initialPot">Initial Pot (CRO sent with tx)</label>
                            <input id="initialPot" name="initialPot"
                                type="number" step="any" min="0" 
                                inputmode="decimal" placeholder="Optional"
                                class="form-control">
                        </div>

                        <div class="col-lg-6">
                        <label class="form-label" for="enrollmentStart">Enrollment Start</label>
                            <input id="enrollmentStart" name="enrollmentStart" type="datetime-local"
                                    class="form-control" required>
                        </div>

                        <div class="col-lg-6">
                            <label class="form-label" for="enrollmentEnd">Enrollment End</label>
                            <input id="enrollmentEnd" name="enrollmentEnd" type="datetime-local"
                                    class="form-control" required>
                        </div>

                        <div class="col-lg-6">
                            <label class="form-label" for="missionStart">Mission Start</label>
                            <input id="missionStart" name="missionStart" type="datetime-local"
                                    class="form-control" required>
                        </div>

                        <div class="col-lg-6">
                            <label class="form-label" for="missionEnd">Mission End</label>
                            <input id="missionEnd" name="missionEnd" type="datetime-local"
                                    class="form-control" required>
                        </div>

                        <div class="col-md-6">
                            <label class="form-label" for="minPlayers">Min Players</label>
                            <input id="minPlayers" name="minPlayers" type="number" min="5" placeholder=">= Misson Rounds"
                                    class="form-control" required>
                        </div>

                        <div class="col-md-6">
                            <label class="form-label" for="maxPlayers">Max Players</label>
                            <input id="maxPlayers" name="maxPlayers" type="number" min="5" placeholder=">= Min Players"
                                    class="form-control" required>
                        </div>

                        <div class="col-md-6">
                            <label class="form-label" for="rounds">Mission Rounds</label>
                            <input id="rounds" name="rounds" type="number" min="5" placeholder=">= 5"
                                    class="form-control" required>
                        </div>

                        <div class="col-md-6">
                            <label class="form-label" for="enrollmentAmount">Enrollment Fee (CRO)</label>
                            <input id="enrollmentAmount" name="enrollmentAmount"
                                type="number" step="any" min="0"
                                inputmode="decimal" placeholder="e.g. 12.34"
                                class="form-control" required>
                        </div>

                        <div class="col-12 d-flex justify-content-end">
                            <div class="d-flex align-items-center gap-3">
                                <small id="formInvalidNotice" class="text-danger d-none">
                                    Not all conditions are met
                                </small>

                                <button id="createMissionBtn" type="submit" class="btn btn-sm btn-outline-info" disabled>
                                    Create Mission
                                </button>

                            </div>
                        </div>
                    </form>
                </section>

                <!-- 2 ▸ Factory Read functions -->
                <section id="factory-read" class="col-12 section-box hidden">
                    <div class="section-header position-relative mb-3">
                        <!-- Title centered between left and right -->
                        <h2 class="section-title text-center mb-0 w-100">
                            <i class="fa-solid fa-eye me-2"></i>Factory Read Functions
                        </h2>

                        <!-- Reload button in top-right, with spinner overlaid -->
                        <button id="reloadRead" class="btn btn-sm btn-outline-info position-absolute top-50 end-0 translate-middle-y me-2">
                            <i class="fa-solid fa-rotate"></i>
                            <span id="readSpinner" class="fade-spinner position-absolute top-50 start-50 translate-middle">
                                <span class="spinner"></span>
                            </span>
                        </button>
                    </div>

                    <!-- 1 ▸ Global stats -->
                    <div id="globalView" class="row g-3"></div>

                    <!-- 2 ▸ Player-specific -->
                    <div class="mt-4">
                        <form id="playerForm" class="form-pair d-flex flex-wrap gap-2 align-items-end">
                        <label class="form-label form-title mb-2 w-100 text-center">Player&nbsp;Info</label>
                        <div class="flex-grow-1">
                            <input id="playerAddr" class="form-control form-control-sm" placeholder="0x…" />
                        </div>
                        <button class="btn btn-sm btn-outline-primary px-4" type="submit">Lookup</button>
                        </form>
                        <div id="playerView" class="row g-3 mt-3"></div>
                    </div>

                    <!-- 3 ▸ Address checks -->
                    <div class="mt-4">
                        <form id="addrForm"  class="form-pair d-flex flex-wrap gap-2 align-items-end">
                        <label class="form-label form-title mb-2 w-100 text-center">Authorized or Mission?</label>
                        <div class="flex-grow-1">
                            <input id="addrCheck" class="form-control form-control-sm" placeholder="0x…" />
                        </div>
                        <button class="btn btn-sm btn-outline-primary px-4" type="submit">Check</button>
                        </form>
                        <div id="addrView" class="row g-3 mt-3"></div>
                    </div>
                </section>

                <!-- 3 ▸ Factory Write Functions -->
                <section id="factory-write" class="col-12 section-box hidden">
                    <div class="section-header">
                        <h2>Factory Write Functions</h2>
                        <button id="reloadWrite" class="btn btn-sm btn-icon float-end">
                            <span class="spinner fade-spinner" style="opacity: 0;"></span>
                            <span class="label-loading">Reload</span>
                        </button>
                    </div>

                    <div class="view-card">
                        <h4>Set Enrollment Limits</h4>
                        <div class="form-pair">
                            <div class="flex-grow-1">
                                <input id="weeklyLimit" class="form-control form-control-sm" placeholder="Weekly limit (current: ...)" />
                            </div>
                            <div class="flex-grow-1">
                                <input id="monthlyLimit" class="form-control form-control-sm" placeholder="Monthly limit (current: ...)" />
                            </div>
                            <button onclick="setEnrollmentLimits(this)" class="btn btn-sm btn-outline-primary">
                                <span class="spinner fade-spinner" style="opacity: 0;"></span>
                                <span class="label-loading">Submit</span>
                            </button>
                        </div>
                    </div>

                    <div class="view-card">
                        <h4>Add Authorized Address</h4>
                        <div class="form-pair">
                            <div class="flex-grow-1">
                                <input id="authAdd" class="form-control form-control-sm" placeholder="Address to add" />
                            </div>
                            <button onclick="addAuthorizedAddress(this)" class="btn btn-sm btn-outline-primary">
                                <span class="spinner fade-spinner" style="opacity: 0;"></span>
                                <span class="label-loading">Add</span>
                            </button>
                        </div>
                    </div>

                    <div class="view-card">
                        <h4>Remove Authorized Address</h4>
                        <div class="form-pair">
                            <div class="flex-grow-1">
                                <input id="authRemove" class="form-control form-control-sm" placeholder="Address to remove" />
                            </div>
                            <button onclick="removeAuthorizedAddress(this)" class="btn btn-sm btn-outline-primary">
                                <span class="spinner fade-spinner" style="opacity: 0;"></span>
                                <span class="label-loading">Remove</span>
                            </button>
                        </div>
                    </div>

                    <div class="view-card">
                        <h4>Propose Ownership Transfer</h4>
                        <div class="form-pair">
                            <div class="flex-grow-1">
                                <input id="proposeOwner" class="form-control form-control-sm" placeholder="New owner address" />
                            </div>
                            <button onclick="proposeOwnershipTransfer(this)" class="btn btn-sm btn-outline-warning">
                                <span class="spinner fade-spinner" style="opacity: 0;"></span>
                                <span class="label-loading">Propose</span>
                            </button>
                        </div>
                    </div>

                    <div class="view-card" id="confirmCard" style="display:none;">
                        <h4>Confirm Ownership Transfer</h4>
                        <div class="confirm-grid">
                            <div>
                                <small class="d-block text-muted">Proposed Owner:</small>
                                <span id="proposedOwnerShort" class="text-white fw-bold"></span>
                            </div>
                            <div>
                                <small class="d-block text-muted">Proposed By:</small>
                                <span id="proposerShort" class="text-white fw-bold"></span>
                            </div>
                            <div>
                                <small class="d-block text-muted">Time Left:</small>
                                <span id="proposalCountdown" class="text-warning fw-bold">—</span>
                            </div>
                            <div class="btn-cell">
                            <button id="confirmBtn" onclick="confirmOwnershipTransfer()" class="btn btn-sm btn-outline-warning">
                                Confirm
                            </button>
                            </div>
                        </div>
                    </div>

                    <div class="view-card">
                        <h4>Withdraw Funds <span id="fundsAvailable" class="ms-2 text-muted">(…)</span></h4>
                        <div class="form-pair">
                            <div class="flex-grow-1">
                                <input id="withdrawAmount" class="form-control form-control-sm" placeholder="Amount in CRO" />
                            </div>
                            <div class="button-pair">
                                <button onclick="setMaxWithdraw()" class="btn btn-sm btn-outline-secondary">Max</button>
                                <button id="withdrawBtn" onclick="withdrawFunds(this)" class="btn btn-sm btn-outline-danger">
                                    <span class="spinner fade-spinner" style="opacity: 0;"></span>
                                    <span class="label-loading">Withdraw</span>
                                </button>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Mission details -->
                <section id="missionModal" class="col-12 section-box hidden">
                    <div class="position-relative">
                        <button id="missionModalClose" class="btn btn-sm btn-outline-info position-absolute top-0 end-0">
                            <i class="fa-solid fa-xmark"></i>
                        </button>
                        <h2 id="missionModalTitle" class="section-title m-0"></h2>
                    </div>
                    <div id="missionModalBody" class="mt-3"></div>
                </section>

            </div>
    </main>

    <footer class="app-footer">
        <div class="inner gap-2">
            <button class="btn btn-sm btn-outline-info icon-nav admin-only-btn" data-target="missionsSection"       title="Missions">
                <i class="fa-solid fa-list"></i>
            </button>
            <button class="btn btn-sm btn-outline-info icon-nav admin-only-btn" data-target="createMissionSection"  title="Create Mission">
                <i class="fa-solid fa-plus"></i>
            </button>

            <button id="connectWalletBtn" class="btn btn-sm btn-outline-info">
                <i class="fa-solid fa-wallet me-2"></i>
                <span id="connectBtnText">Connect Wallet</span>
            </button>

            <button class="btn btn-sm btn-outline-info icon-nav admin-only-btn" data-target="factory-write"         title="Factory Write Functions">
                <i class="fa-solid fa-user-shield"></i>
            </button>

            <button class="btn btn-sm btn-outline-info icon-nav admin-only-btn" data-target="factory-read"          title="Factory Read Functions">
                <i class="fa-solid fa-eye"></i>
            </button>
        </div>
    </footer>

    <!-- REUSABLE MODALS (identical markup) -->
    <div id="modalOverlay" class="modal-overlay">

        <div id="confirmModal" class="modal-box hidden">
            <p id="modalMessage" class="mb-4"></p>
            <div class="d-flex gap-3 justify-content-center">
                <button id="modalConfirm" class="btn btn-cyan px-4">Yes</button>
                <button id="modalCancel"  class="btn btn-outline-cyan px-4">Cancel</button>
            </div>
        </div>

        <div id="alertModal" class="modal-box hidden">
            <h3 id="alertModalTitle" class="modal-title mb-3"></h3>
            <p  id="alertModalText"  class="mb-4"></p>
            <button id="alertModalCloseBtn" class="btn btn-cyan px-4">Close</button>
        </div>

    </div>

</body>
</html>
